
# Prunt Simulator: Deep Dive Reference & Usage Guide

## Quick Navigation & Related Documents
- [Master Actionable Checklist](master_actionable_checklist.md)
- [Data Engineering & Management Plan](data_engineering_plan.md)
- [Prunt3D Ingestion Design](prunt3d_ingest_design.md)

---

## Onboarding: Getting Started
**Who should use this?** Anyone working on simulation data generation, kinematic analysis, or integration with the LLM data pipeline.

**Quick Start:**
1. Install Ada (via Alire) and Python dependencies (see below).
2. Build the simulator with `alr build --release`.
3. Edit `prunt_sim.toml` to configure your simulation.
4. Run the simulator and capture output to CSV.
5. Use Python utilities for real-time or post-process analysis.
6. Ingest outputs into the data pipeline (see [Data Engineering & Management Plan](data_engineering_plan.md)).

**Integration:**
- The CSV and metadata outputs from Prunt Simulator are the primary inputs for the ingestion and feature extraction steps in the data pipeline.
- For details on expected formats and downstream usage, see [Prunt3D Ingestion Design](prunt3d_ingest_design.md).

---

## 1. Directory Structure & Key Files
- **alire.toml**: Project manifest for Ada build system (Alire)
- **prunt_simulator.gpr**: Ada project configuration
- **src/prunt_simulator.adb**: Main Ada source file for the simulator
- **continuous_plot.py**: Real-time plotting and visualization utility (Python)
- **plot.py**: Post-processing and kinematic analysis (Python)
- **run.sh**: Example shell script for running the simulator and capturing output
- **prunt_sim.toml**: Example configuration for simulation parameters
- **README.org**: Quickstart and plotting instructions

---

## 2. Building the Simulator
1. **Install Alire (Ada package manager)**
2. **Install dependencies** (see `alire.toml`)
3. **Build the simulator**:
   ```sh
   alr build --release
   # Executable will be in ./bin/prunt_simulator
   ```

---

## 3. Running the Simulator
- **Basic Run**:
  ```sh
  ./bin/prunt_simulator
  ```
- **With Real-Time Plotting** (from `README.org`):
  ```sh
  stdbuf -oL -eL ./bin/prunt_simulator | stdbuf -oL -eL awk '/DATA OUTPUT,/ {print > "/dev/stdout"} !/DATA OUTPUT,/ {print > "/dev/stderr"}' | stdbuf -oL -eL python3 ./continuous_plot.py
  ```
- **With Output Capture** (from `run.sh`):
  ```sh
  rm tmp.csv && ./bin/prunt_simulator | tee >(grep -v ".*,.*,.*,.*,,,," >> /dev/stdout) | grep ".*,.*,.*,.*,.*,,,,"  > tmp.csv
  ```

---

## 4. Output Files & Data
- **tmp.csv**: Captured simulation data (positions, velocities, etc.)
- **prunt_sim.toml/json**: Configuration and metadata for simulation runs
- **Images/Plots**: Generated by Python scripts for kinematic analysis

---

## 5. Python Utilities
- **continuous_plot.py**: Real-time, interactive plotting of simulation data (positions, velocity, acceleration, jerk, snap, crackle)
  - Uses matplotlib, numpy, threading
  - Supports pausing, step size, plot length controls
- **plot.py**: Post-processes CSV data for kinematic analysis and visualization
  - Computes and plots velocity, acceleration, jerk, snap, crackle
  - Uses Savitzky-Golay filtering for smoothing

---

## 6. Configuration & Customization
- **prunt_sim.toml**: Main config for kinematics, heaters, fans, steppers, etc.
  - Edit to change printer parameters, motion limits, and simulation settings
- **Ada source (src/prunt_simulator.adb)**: For advanced users, modify Ada code for new features or behaviors

---

## 7. Typical Workflow
1. Edit `prunt_sim.toml` to set up your printer/simulation parameters
2. Build the simulator with Alire
3. Run the simulator, capturing output to CSV
4. Use `continuous_plot.py` for real-time visualization, or `plot.py` for post-processing
5. Analyze kinematic data for LLM training, benchmarking, or research

---

## 8. Advanced Usage & Notes
- **Threading**: Python plotting utilities use threading for real-time updates
- **Data Format**: CSV output is expected to have 5 columns; malformed lines are ignored
- **Extensibility**: Ada code is modular; new kinematic models or sensors can be added
- **License**: GPLv3 (see COPYING)

---

## 9. Example: Real-Time Plotting Command
```sh
stdbuf -oL -eL ./bin/prunt_simulator | stdbuf -oL -eL awk '/DATA OUTPUT,/ {print > "/dev/stdout"} !/DATA OUTPUT,/ {print > "/dev/stderr"}' | stdbuf -oL -eL python3 ./continuous_plot.py
```

---


## 10. Troubleshooting & Tips
- **Build errors:**
  - Double-check Ada/Alire installation and all dependencies listed in `alire.toml`.
  - Run `alr doctor` for diagnostic info.
- **No output in CSV:**
  - Ensure the simulator is running and the output command is correct.
  - Check for permission issues in the output directory.
- **Plotting issues:**
  - Verify Python dependencies: `matplotlib`, `numpy`, `scipy`.
  - Try running the plotting scripts standalone with sample CSVs.
- **Data format errors:**
  - Confirm that CSV output matches the expected 5-column format.
  - Use the provided Python scripts to validate and visualize outputs before ingestion.
- **Integration with pipeline:**
  - If ingestion scripts fail, check that all required files (CSV, metadata, images) are present and not empty.
  - See [Data Engineering & Management Plan](data_engineering_plan.md) for troubleshooting pipeline integration.

---

---

## 11. References
- [Prunt3D Project](https://prunt3d.com/) (if available)
- AdaCore, Alire documentation
- Python: matplotlib, numpy, scipy docs

---


## 12. TODO & Open Questions
- [ ] Document all CSV output fields and their meanings (add table in this doc)
- [ ] Add more example configurations and use cases (especially for edge cases)
- [ ] Integrate with LLM data pipeline for automated scenario generation (see [Data Engineering & Management Plan](data_engineering_plan.md))
- [ ] Expand Python utilities for multi-modal data (images, audio)

---

---
